<!DOCTYPE html>
<html>
<body>
<style>
  #previewContainer {
    width: 100%;
    height: 60vh;
    overflow: hidden;
    position: relative;
    background: black;
  }

  #preview {
    width: 100%;
    height: 100%;
    object-fit: cover;        /* ← これがとても重要 */
    transform-origin: center center;  /* 中央からズーム */
  }

  #captureCanvas {
    display: none;
  }
</style>

<div id="previewContainer">
  <video id="preview" autoplay playsinline muted></video>
</div>

<input id="zoom" type="range" min="1" max="20" value="1" step="0.1">
<button onclick="takePhoto()">撮影</button>

<canvas id="captureCanvas"></canvas>

<script>
let stream;
let video = document.getElementById("preview");
let zoomBar = document.getElementById("zoom");

async function startCamera() {
    try {
        stream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: "environment" },
            audio: false
        });

        video.srcObject = stream;

        video.onloadedmetadata = () => {
            video.play();
            applyZoom();
        };

    } catch(e) {
        alert("Camera error: " + e.name);
    }
}

function applyZoom() {
    const z = zoomBar.value;
    video.style.transform = `scale(${z})`;  
}

zoomBar.oninput = applyZoom;

function takePhoto() {
    const canvas = document.getElementById("captureCanvas");
    const ctx = canvas.getContext("2d");

    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;

    const zoom = zoomBar.value;

    const w = canvas.width / zoom;
    const h = canvas.height / zoom;
    const x = (canvas.width - w) / 2;
    const y = (canvas.height - h) / 2;

    ctx.drawImage(video, x, y, w, h, 0, 0, canvas.width, canvas.height);

    const url = canvas.toDataURL("image/jpeg");
    window.open(url);
}

startCamera();
</script>
</body>
</html>
